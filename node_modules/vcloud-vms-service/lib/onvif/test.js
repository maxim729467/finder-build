const keypress = require('keypress');

const ONVIFCamera = require('./');
const { COMMANDS } = require('./config');

const commandConf = {
  up:     'up',
  down:   'down',
  left:   'left',
  right:  'right',
  z:      'zoomOut',
  x:      'zoomIn',
  s:      'stopMove',
};

const camConf = {
  // xaddr: 'http://195.138.65.68:18999',
  // xaddr: 'http://192.168.0.151',
  ip: '192.168.0.11',
  port: null,
  user: 'admin',
  pass: 'admin',
};

const camera = new ONVIFCamera();
camera.init(camConf);

const readAndProcessKeyboard = () => {
  // listen for the "keypress" events
  keypress(process.stdin);
  process.stdin.setRawMode(true);
  process.stdin.resume();

  console.log('\nUse Cursor Keys to move camera. z and x to zoom. q to quit');

  // keypress handler
  process.stdin.on('keypress', (ch, key) => {
    /* Exit on 'q' or 'Q' or 'CTRL C' */
    if ((key && key.ctrl && key.name === 'c') || (key && key.name === 'q')) process.exit();

    if (!key || !commandConf[key.name]) return;

    if (key.name === 's') {
      camera.stop();
      return;
    }

    console.log('command:', commandConf[key.name]);
    console.log('event:', COMMANDS[commandConf[key.name]]);
    camera.move(commandConf[key.name]);
  });
};

readAndProcessKeyboard();
